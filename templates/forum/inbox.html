{% extends "forum/base.html" %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <div class="max-w-6xl mx-auto bg-white h-screen flex">
        
        <!-- Conversations Sidebar -->
        <div class="w-96 border-r border-gray-200 bg-white flex flex-col h-full">
            <!-- Sidebar Header -->
            <div class="p-4 border-b border-gray-200 flex-shrink-0">
                <div class="flex items-center justify-between mb-4">
                    <h1 class="text-xl font-semibold text-gray-900">Messages</h1>
                    <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors text-gray-600">
                        <i class="fas fa-edit text-sm"></i>
                    </button>
                </div>
                
                <!-- Search Bar -->
                <div class="relative">
                    <input 
                        type="text" 
                        placeholder="Search messages..." 
                        class="w-full pl-9 pr-4 py-2.5 bg-gray-100 border-0 rounded-lg focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none transition-all duration-200 text-sm"
                    >
                    <i class="fas fa-search absolute left-3 top-2.5 text-gray-400 text-sm"></i>
                </div>
            </div>

            <!-- Conversations List - Now with proper scrolling -->
            <div class="flex-1 overflow-y-auto" style="max-height: calc(100vh - 180px);">
                <!-- Mock Conversations Data -->
                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer bg-blue-50" data-user-id="1">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center text-white font-medium">
                                S
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">Sarah Chen</h3>
                                <span class="text-xs text-gray-500">2:45 PM</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                Hey! Are we still meeting tomorrow for the community project?
                            </p>
                        </div>
                    </div>
                </div>

                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-user-id="2">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium">
                                M
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">Mike Rodriguez</h3>
                                <span class="text-xs text-gray-500">1:30 PM</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                Just shared the document we discussed. Let me know your thoughts!
                            </p>
                        </div>
                        <div class="flex-shrink-0">
                            <span class="w-5 h-5 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-medium">
                                3
                            </span>
                        </div>
                    </div>
                </div>

                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-user-id="3">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-full flex items-center justify-center text-white font-medium">
                                A
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-gray-400 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">Alex Thompson</h3>
                                <span class="text-xs text-gray-500">11:15 AM</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                Thanks for your help with the forum issue yesterday!
                            </p>
                        </div>
                    </div>
                </div>

                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-user-id="4">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full flex items-center justify-center text-white font-medium">
                                E
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">Emma Wilson</h3>
                                <span class="text-xs text-gray-500">Yesterday</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                The community event was amazing! We should organize more like this
                            </p>
                        </div>
                        <div class="flex-shrink-0">
                            <span class="w-5 h-5 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-medium">
                                1
                            </span>
                        </div>
                    </div>
                </div>

                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-user-id="5">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-full flex items-center justify-center text-white font-medium">
                                D
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">David Kim</h3>
                                <span class="text-xs text-gray-500">Yesterday</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                Can you review my post before I publish it?
                            </p>
                        </div>
                    </div>
                </div>

                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-user-id="6">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-blue-600 rounded-full flex items-center justify-center text-white font-medium">
                                J
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-gray-400 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">Community Moderators</h3>
                                <span class="text-xs text-gray-500">Dec 12</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                Monthly moderator meeting scheduled for Friday
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Additional conversations to demonstrate scrolling -->
                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-user-id="7">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-teal-500 to-green-600 rounded-full flex items-center justify-center text-white font-medium">
                                L
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">Lisa Park</h3>
                                <span class="text-xs text-gray-500">Dec 11</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                The design system updates are ready for review
                            </p>
                        </div>
                    </div>
                </div>

                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-user-id="8">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-pink-500 to-rose-600 rounded-full flex items-center justify-center text-white font-medium">
                                R
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-gray-400 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">Ryan Patel</h3>
                                <span class="text-xs text-gray-500">Dec 10</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                Can you help with the backend integration?
                            </p>
                        </div>
                        <div class="flex-shrink-0">
                            <span class="w-5 h-5 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-medium">
                                2
                            </span>
                        </div>
                    </div>
                </div>

                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-user-id="9">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center text-white font-medium">
                                T
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">Taylor Morgan</h3>
                                <span class="text-xs text-gray-500">Dec 9</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                User feedback has been overwhelmingly positive!
                            </p>
                        </div>
                    </div>
                </div>

                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-user-id="10">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center text-white font-medium">
                                K
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">Kevin Zhang</h3>
                                <span class="text-xs text-gray-500">Dec 8</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                The analytics dashboard is now live
                            </p>
                        </div>
                    </div>
                </div>

                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-user-id="11">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-violet-500 to-purple-600 rounded-full flex items-center justify-center text-white font-medium">
                                N
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-gray-400 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">Nadia Hassan</h3>
                                <span class="text-xs text-gray-500">Dec 7</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                Community guidelines updated successfully
                            </p>
                        </div>
                    </div>
                </div>

                <div class="conversation-item border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer" data-user-id="12">
                    <div class="flex items-center space-x-3 p-3">
                        <div class="relative flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-emerald-500 to-green-600 rounded-full flex items-center justify-center text-white font-medium">
                                C
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-0.5">
                                <h3 class="font-medium text-gray-900 text-sm truncate">Chris O'Donnell</h3>
                                <span class="text-xs text-gray-500">Dec 6</span>
                            </div>
                            <p class="text-xs text-gray-600 truncate leading-tight">
                                New feature deployment completed without issues
                            </p>
                        </div>
                        <div class="flex-shrink-0">
                            <span class="w-5 h-5 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-medium">
                                5
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Profile Footer -->
            <div class="border-t border-gray-200 p-4 flex-shrink-0">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center text-white font-medium">
                        {{ user.username|first|upper }}
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-gray-900 text-sm truncate">{{ user.username }}</p>
                        <p class="text-xs text-gray-500 truncate">Online</p>
                    </div>
                    <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors text-gray-600">
                        <i class="fas fa-cog text-sm"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="flex-1 flex flex-col h-full">
            <!-- Chat Header -->
            <div class="bg-gray-50 border-b border-gray-200 px-4 py-3 flex items-center justify-between flex-shrink-0">
                <div class="flex items-center space-x-3">
                    <!-- Back Button (Mobile) -->
                    <button id="back-to-conversations" class="lg:hidden w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 transition-colors">
                        <i class="fas fa-arrow-left text-gray-600 text-sm"></i>
                    </button>
                    
                    <!-- Recipient Info -->
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center text-white font-medium">
                                S
                            </div>
                            <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                        </div>
                        <div>
                            <h1 class="text-base font-medium text-gray-900">Sarah Chen</h1>
                            <p class="text-xs text-gray-500">Active now</p>
                        </div>
                    </div>
                </div>

                <!-- Header Actions -->
                <div class="flex items-center space-x-1">
                    <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 transition-colors text-gray-600">
                        <i class="fas fa-phone text-sm"></i>
                    </button>
                    <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 transition-colors text-gray-600">
                        <i class="fas fa-video text-sm"></i>
                    </button>
                    <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 transition-colors text-gray-600">
                        <i class="fas fa-ellipsis-v text-sm"></i>
                    </button>
                </div>
            </div>

            <!-- Messages Area - Now with proper scrolling -->
            <div id="messages-container" class="flex-1 overflow-y-auto" style="max-height: calc(100vh - 180px);">
                <!-- All your existing messages content here -->
                <!-- (Keeping the message content the same as before to save space) -->
                <div class="text-center mb-6">
                    <span class="inline-block bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full">
                        Today
                    </span>
                </div>

                <!-- Received Messages -->
                <div class="message-group mb-4">
                    <div class="inline-block max-w-xs lg:max-w-md">
                        <div class="flex items-end space-x-2 mb-1">
                            <div class="w-6 h-6 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center text-white text-xs font-medium flex-shrink-0">
                                S
                            </div>
                            <div class="text-left">
                                <div class="text-xs text-gray-500 mb-1">Sarah Chen • 2:30 PM</div>
                                <div class="bg-gray-100 rounded-2xl rounded-bl-none px-4 py-2 inline-block">
                                    <p class="text-gray-900 text-sm">Hey! Are we still meeting tomorrow for the community project?</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sent Messages -->
                <div class="message-group mb-4 text-right">
                    <div class="inline-block max-w-xs lg:max-w-md">
                        <div class="text-right">
                            <div class="text-xs text-gray-500 mb-1 flex items-center justify-end space-x-1">
                                <span>2:32 PM</span>
                                <i class="fas fa-check-double text-blue-500 text-xs"></i>
                            </div>
                            <div class="bg-blue-500 text-white rounded-2xl rounded-br-none px-4 py-2 inline-block">
                                <p class="text-sm">Yes, definitely! I was just reviewing the project timeline</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ... rest of the messages ... -->
                <!-- Adding more messages to demonstrate scrolling in chat area too -->
                <div class="message-group mb-4">
                    <div class="inline-block max-w-xs lg:max-w-md">
                        <div class="flex items-end space-x-2 mb-1">
                            <div class="w-6 h-6 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center text-white text-xs font-medium flex-shrink-0">
                                S
                            </div>
                            <div class="text-left">
                                <div class="text-xs text-gray-500 mb-1">Sarah Chen • 2:40 PM</div>
                                <div class="bg-gray-100 rounded-2xl rounded-bl-none px-4 py-2 inline-block">
                                    <p class="text-gray-900 text-sm">I've also been thinking about the user onboarding flow. What if we added a guided tour for new members?</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="message-group mb-4 text-right">
                    <div class="inline-block max-w-xs lg:max-w-md">
                        <div class="text-right">
                            <div class="text-xs text-gray-500 mb-1 flex items-center justify-end space-x-1">
                                <span>2:42 PM</span>
                                <i class="fas fa-check text-gray-400 text-xs"></i>
                            </div>
                            <div class="bg-blue-500 text-white rounded-2xl rounded-br-none px-4 py-2 inline-block">
                                <p class="text-sm">That's a great idea! We could use the new tutorial system we built last month</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="message-group mb-4">
                    <div class="inline-block max-w-xs lg:max-w-md">
                        <div class="flex items-end space-x-2 mb-1">
                            <div class="w-6 h-6 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center text-white text-xs font-medium flex-shrink-0">
                                S
                            </div>
                            <div class="text-left">
                                <div class="text-xs text-gray-500 mb-1">Sarah Chen • 2:43 PM</div>
                                <div class="bg-gray-100 rounded-2xl rounded-bl-none px-4 py-2 inline-block">
                                    <p class="text-gray-900 text-sm">Exactly! And we could integrate it with the community guidelines to make sure everyone starts on the right foot</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="message-group mb-4 text-right">
                    <div class="inline-block max-w-xs lg:max-w-md">
                        <div class="text-right">
                            <div class="text-xs text-gray-500 mb-1 flex items-center justify-end space-x-1">
                                <span>2:45 PM</span>
                                <i class="fas fa-check text-gray-400 text-xs"></i>
                            </div>
                            <div class="bg-blue-500 text-white rounded-2xl rounded-br-none px-4 py-2 inline-block">
                                <p class="text-sm">Perfect. Let's discuss this more tomorrow and create a project plan</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div id="typing-indicator" class="hidden px-4 py-2 flex-shrink-0">
                <div class="flex items-end space-x-2">
                    <div class="w-6 h-6 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center text-white text-xs font-medium flex-shrink-0">
                        S
                    </div>
                    <div class="bg-gray-100 rounded-2xl rounded-bl-none px-4 py-3">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Message Input -->
            <div class="border-t border-gray-200 bg-white p-4 flex-shrink-0">
                <form method="POST" class="flex items-end space-x-2" id="message-form">
                    {% csrf_token %}
                    <input type="hidden" name="recipient_id" value="1">
                    
                    <!-- Attachment Button -->
                    <button type="button" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors text-gray-500 flex-shrink-0">
                        <i class="fas fa-plus text-sm"></i>
                    </button>

                    <!-- Message Input -->
                    <div class="flex-1 relative">
                        <textarea 
                            name="content" 
                            placeholder="Message..." 
                            required
                            rows="1"
                            class="w-full px-4 py-2.5 bg-gray-100 border-0 rounded-full focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none transition-all duration-200 resize-none text-sm placeholder-gray-500"
                            id="message-input"
                        ></textarea>
                        <div class="absolute right-2 bottom-1.5 flex items-center space-x-1">
                            <button type="button" class="w-7 h-7 flex items-center justify-center rounded-full hover:bg-gray-200 transition-colors text-gray-500">
                                <i class="fas fa-smile text-sm"></i>
                            </button>
                            <button type="button" class="w-7 h-7 flex items-center justify-center rounded-full hover:bg-gray-200 transition-colors text-gray-500">
                                <i class="fas fa-paperclip text-sm"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Send Button -->
                    <button 
                        type="submit" 
                        class="w-9 h-9 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors flex items-center justify-center flex-shrink-0"
                        id="send-button"
                    >
                        <i class="fas fa-paper-plane text-sm"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    /* Custom scrollbar for both containers */
    #messages-container::-webkit-scrollbar,
    .overflow-y-auto::-webkit-scrollbar {
        width: 6px;
    }

    #messages-container::-webkit-scrollbar-track,
    .overflow-y-auto::-webkit-scrollbar-track {
        background: #f8fafc;
    }

    #messages-container::-webkit-scrollbar-thumb,
    .overflow-y-auto::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }

    #messages-container::-webkit-scrollbar-thumb:hover,
    .overflow-y-auto::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }

    /* Ensure proper height calculations */
    .h-full {
        height: 100%;
    }

    /* Message animations */
    .message-group {
        animation: messageSlideIn 0.2s ease-out;
    }

    @keyframes messageSlideIn {
        from {
            opacity: 0;
            transform: translateY(8px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Auto-resize textarea */
    #message-input {
        min-height: 40px;
        max-height: 120px;
    }

    /* Clean hover states */
    .conversation-item {
        transition: background-color 0.15s ease;
    }

    .conversation-item:hover {
        background-color: #f8fafc;
    }

    /* Mobile responsive */
    @media (max-width: 1024px) {
        .w-96 {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            z-index: 40;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            width: 100% !important;
            max-width: 380px;
        }
        
        .w-96.active {
            transform: translateX(0);
        }
    }

    /* Prevent flex-shrink on critical elements */
    .flex-shrink-0 {
        flex-shrink: 0;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const messageInput = document.getElementById('message-input');
        const messageForm = document.getElementById('message-form');
        const messagesContainer = document.getElementById('messages-container');
        const sendButton = document.getElementById('send-button');
        const typingIndicator = document.getElementById('typing-indicator');
        const backButton = document.getElementById('back-to-conversations');
        const conversationItems = document.querySelectorAll('.conversation-item');

        // Auto-scroll both containers to top initially
        function initializeScrollPositions() {
            // Scroll conversations to top
            const conversationsContainer = document.querySelector('.overflow-y-auto');
            if (conversationsContainer) {
                conversationsContainer.scrollTop = 0;
            }
            
            // Scroll messages to bottom
            if (messagesContainer) {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        initializeScrollPositions();

        // Rest of your existing JavaScript functionality...
        // (Keeping all the existing JavaScript the same)
        
        // Simulate realistic conversation switching
        conversationItems.forEach(item => {
            item.addEventListener('click', function() {
                const userId = this.getAttribute('data-user-id');
                
                // Update active state
                conversationItems.forEach(i => i.classList.remove('bg-blue-50'));
                this.classList.add('bg-blue-50');
                
                // Clear unread badges
                const unreadBadge = this.querySelector('.bg-blue-500');
                if (unreadBadge) {
                    unreadBadge.remove();
                }

                // On mobile, hide sidebar after selection
                if (window.innerWidth < 1024) {
                    document.querySelector('.w-96').classList.remove('active');
                }
            });
        });

        // Mobile back button
        if (backButton) {
            backButton.addEventListener('click', function() {
                document.querySelector('.w-96').classList.add('active');
            });
        }

        // Auto-resize textarea
        if (messageInput) {
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                
                // Enable/disable send button
                if (this.value.trim()) {
                    sendButton.disabled = false;
                    sendButton.classList.remove('opacity-50');
                } else {
                    sendButton.disabled = true;
                    sendButton.classList.add('opacity-50');
                }
            });

            // Send message on Enter (but allow Shift+Enter for new line)
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    if (this.value.trim()) {
                        simulateMessageSend(this.value);
                        this.value = '';
                        this.style.height = 'auto';
                        sendButton.disabled = true;
                        sendButton.classList.add('opacity-50');
                    }
                }
            });
        }

        // Simulate sending a message
        function simulateMessageSend(content) {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true });
            
            const messageHTML = `
                <div class="message-group mb-4 text-right">
                    <div class="inline-block max-w-xs lg:max-w-md">
                        <div class="text-right">
                            <div class="text-xs text-gray-500 mb-1 flex items-center justify-end space-x-1">
                                <span>${timeString}</span>
                                <i class="fas fa-check text-gray-400 text-xs"></i>
                            </div>
                            <div class="bg-blue-500 text-white rounded-2xl rounded-br-none px-4 py-2 inline-block">
                                <p class="text-sm">${content}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
            scrollToBottom();
            
            // Simulate reply after 1-3 seconds
            setTimeout(() => {
                simulateReply();
            }, 1000 + Math.random() * 2000);
        }

        // Simulate receiving a reply
        function simulateReply() {
            const replies = [
                "That makes sense!",
                "I'll get back to you on that",
                "Can we discuss this tomorrow?",
                "Thanks for letting me know!",
                "I agree with your point",
                "Let me check and get back to you"
            ];
            
            const randomReply = replies[Math.floor(Math.random() * replies.length)];
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true });
            
            const messageHTML = `
                <div class="message-group mb-4">
                    <div class="inline-block max-w-xs lg:max-w-md">
                        <div class="flex items-end space-x-2 mb-1">
                            <div class="w-6 h-6 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center text-white text-xs font-medium flex-shrink-0">
                                S
                            </div>
                            <div class="text-left">
                                <div class="text-xs text-gray-500 mb-1">Sarah Chen • ${timeString}</div>
                                <div class="bg-gray-100 rounded-2xl rounded-bl-none px-4 py-2 inline-block">
                                    <p class="text-gray-900 text-sm">${randomReply}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
            scrollToBottom();
        }

        // Auto-scroll to bottom of messages
        function scrollToBottom() {
            if (messagesContainer) {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        // Simulate typing indicator
        let typingTimeout;
        if (messageInput) {
            messageInput.addEventListener('input', function() {
                if (this.value.trim() && typingIndicator) {
                    typingIndicator.classList.remove('hidden');
                    clearTimeout(typingTimeout);
                    typingTimeout = setTimeout(() => {
                        typingIndicator.classList.add('hidden');
                    }, 1000);
                } else if (typingIndicator) {
                    typingIndicator.classList.add('hidden');
                }
            });
        }

        // Search functionality
        const searchInput = document.querySelector('input[type="text"]');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                conversationItems.forEach(item => {
                    const username = item.querySelector('.font-medium').textContent.toLowerCase();
                    if (username.includes(searchTerm)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }
    });
</script>
{% endblock %}